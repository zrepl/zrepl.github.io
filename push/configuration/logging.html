

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Logging &mdash; zrepl  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="zrepl  documentation" href="../index.html"/>
        <link rel="up" title="Configuration" href="../configuration.html"/>
        <link rel="next" title="Miscellaneous" href="misc.html"/>
        <link rel="prev" title="Pruning Policies" href="prune.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> zrepl
          

          
            
            <img src="../_static/zrepl.svg" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l2"><a class="reference internal" href="jobs.html">Job Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="transports.html">Transports</a></li>
<li class="toctree-l2"><a class="reference internal" href="map_filter_syntax.html">Mapping &amp; Filter Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="prune.html">Pruning Policies</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#default-configuration">Default Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-blocks">Building Blocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#levels">Levels</a></li>
<li class="toctree-l4"><a class="reference internal" href="#formats">Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#outlets">Outlets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#stdout-outlet"><code class="docutils literal"><span class="pre">stdout</span></code> Outlet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#syslog-outlet"><code class="docutils literal"><span class="pre">syslog</span></code> Outlet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tcp-outlet"><code class="docutils literal"><span class="pre">tcp</span></code> Outlet</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation.html">Implementation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/zrepl/zrepl">GitHub Repository &amp; Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pr.html">Talks &amp; Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">zrepl</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../configuration.html">Configuration</a> &raquo;</li>
        
      <li>Logging</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/configuration/logging.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../../master/configuration/logging.html"><b>Warning:</b> This document is for the development version of zrepl. The main version is master.</a></p>
<div class="section" id="logging">
<span id="id1"></span><h1>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<p>zrepl uses structured logging to provide users with easily processable log messages.</p>
<p>Logging outlets are configured in the <code class="docutils literal"><span class="pre">global</span></code> section of the <a class="reference internal" href="../installation.html#mainconfigfile"><span class="std std-ref">main configuration file</span></a>.
Check out <a class="reference external" href="https://github.com/zrepl/zrepl/blob/master/cmd/sampleconf/random/logging.yml">cmd/sampleconfrandom/logging.yml</a> for an example on how to configure multiple outlets:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">global</span><span class="p">:</span>
  <span class="n">logging</span><span class="p">:</span>

    <span class="o">-</span> <span class="n">outlet</span><span class="p">:</span> <span class="n">OUTLET_TYPE</span>
      <span class="n">level</span><span class="p">:</span> <span class="n">MINIMUM_LEVEL</span>
      <span class="nb">format</span><span class="p">:</span> <span class="n">FORMAT</span>

    <span class="o">-</span> <span class="n">outlet</span><span class="p">:</span> <span class="n">OUTLET_TYPE</span>
      <span class="n">level</span><span class="p">:</span> <span class="n">MINIMUM_LEVEL</span>
      <span class="nb">format</span><span class="p">:</span> <span class="n">FORMAT</span>

    <span class="o">...</span>

<span class="n">jobs</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<div class="admonition attention" id="logging-error-outlet">
<p class="first admonition-title">Attention</p>
<p class="last">The <strong>first outlet is special</strong>: if an error writing to any outlet occurs, the first outlet receives the error and can print it.
Thus, the first outlet must be the one that always works and does not block, e.g. <code class="docutils literal"><span class="pre">stdout</span></code>, which is the default.</p>
</div>
<div class="section" id="default-configuration">
<span id="logging-default-config"></span><h2>Default Configuration<a class="headerlink" href="#default-configuration" title="Permalink to this headline">¶</a></h2>
<p>By default, the following logging configuration is used</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">global</span><span class="p">:</span>
  <span class="n">logging</span><span class="p">:</span>

    <span class="o">-</span> <span class="n">outlet</span><span class="p">:</span> <span class="s2">&quot;stdout&quot;</span>
      <span class="n">level</span><span class="p">:</span>  <span class="s2">&quot;warn&quot;</span>
      <span class="nb">format</span><span class="p">:</span> <span class="s2">&quot;human&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="building-blocks">
<h2>Building Blocks<a class="headerlink" href="#building-blocks" title="Permalink to this headline">¶</a></h2>
<p>The following sections document the semantics of the different log levels, formats and outlet types.</p>
<div class="section" id="levels">
<span id="logging-levels"></span><h3>Levels<a class="headerlink" href="#levels" title="Permalink to this headline">¶</a></h3>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Level</th>
<th class="head">SHORT</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">error</span></code></td>
<td><code class="docutils literal"><span class="pre">ERRO</span></code></td>
<td>immediate action required</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">warn</span></code></td>
<td><code class="docutils literal"><span class="pre">WARN</span></code></td>
<td>symptoms for misconfiguration, soon expected failure, etc.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">info</span></code></td>
<td><code class="docutils literal"><span class="pre">INFO</span></code></td>
<td>explains what happens without too much detail</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">debug</span></code></td>
<td><code class="docutils literal"><span class="pre">DEBG</span></code></td>
<td>tracing information, state dumps, etc. useful for debugging.</td>
</tr>
</tbody>
</table>
<p>Incorrectly classified messages are considered a bug and should be reported.</p>
</div>
<div class="section" id="formats">
<span id="logging-formats"></span><h3>Formats<a class="headerlink" href="#formats" title="Permalink to this headline">¶</a></h3>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Format</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">human</span></code></td>
<td>emphasizes context by putting job, task, step and other context variables into brackets
before the actual message, followed by remaining fields in logfmt style|</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">logfmt</span></code></td>
<td><a class="reference external" href="https://brandur.org/logfmt">logfmt</a> output. zrepl uses <a class="reference external" href="https://github.com/go-logfmt/logfmt">this Go package</a>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">json</span></code></td>
<td>JSON formatted output. Each line is a valid JSON document. Fields are marshaled by
<code class="docutils literal"><span class="pre">encoding/json.Marshal()</span></code>, which is particularly useful for processing in
log aggregation or when processing state dumps.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="outlets">
<h3>Outlets<a class="headerlink" href="#outlets" title="Permalink to this headline">¶</a></h3>
<p>Outlets are the destination for log entries.</p>
</div>
</div>
<div class="section" id="stdout-outlet">
<span id="logging-outlet-stdout"></span><h2><code class="docutils literal"><span class="pre">stdout</span></code> Outlet<a class="headerlink" href="#stdout-outlet" title="Permalink to this headline">¶</a></h2>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">outlet</span></code></td>
<td><code class="docutils literal"><span class="pre">stdout</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">level</span></code></td>
<td>minimum  <a class="reference internal" href="#logging-levels"><span class="std std-ref">log level</span></a></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">format</span></code></td>
<td>output <a class="reference internal" href="#logging-formats"><span class="std std-ref">format</span></a></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">time</span></code></td>
<td>always include time in output (<code class="docutils literal"><span class="pre">true</span></code> or <code class="docutils literal"><span class="pre">false</span></code>)</td>
</tr>
</tbody>
</table>
<p>Writes all log entries with minimum level <code class="docutils literal"><span class="pre">level</span></code> formatted by <code class="docutils literal"><span class="pre">format</span></code> to stdout.
If stdout is a tty, interactive usage is assumed and the current time is included in the output.</p>
<p>Can only be specified once.</p>
</div>
<div class="section" id="syslog-outlet">
<h2><code class="docutils literal"><span class="pre">syslog</span></code> Outlet<a class="headerlink" href="#syslog-outlet" title="Permalink to this headline">¶</a></h2>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">outlet</span></code></td>
<td><code class="docutils literal"><span class="pre">syslog</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">level</span></code></td>
<td>minimum  <a class="reference internal" href="#logging-levels"><span class="std std-ref">log level</span></a></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">format</span></code></td>
<td>output <a class="reference internal" href="#logging-formats"><span class="std std-ref">format</span></a></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">retry_interval</span></code></td>
<td>Interval between reconnection attempts to syslog (default = 0)</td>
</tr>
</tbody>
</table>
<p>Writes all log entries formatted by <code class="docutils literal"><span class="pre">format</span></code> to syslog.
On normal setups, you should not need to change the <code class="docutils literal"><span class="pre">retry_interval</span></code>.</p>
<p>Can only be specified once.</p>
</div>
<div class="section" id="tcp-outlet">
<h2><code class="docutils literal"><span class="pre">tcp</span></code> Outlet<a class="headerlink" href="#tcp-outlet" title="Permalink to this headline">¶</a></h2>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">outlet</span></code></td>
<td><code class="docutils literal"><span class="pre">tcp</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">level</span></code></td>
<td>minimum  <a class="reference internal" href="#logging-levels"><span class="std std-ref">log level</span></a></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">format</span></code></td>
<td>output <a class="reference internal" href="#logging-formats"><span class="std std-ref">format</span></a></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">net</span></code></td>
<td><code class="docutils literal"><span class="pre">tcp</span></code> in most cases</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">address</span></code></td>
<td>remote network, e.g. <code class="docutils literal"><span class="pre">logs.example.com:10202</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">retry_interval</span></code></td>
<td>Interval between reconnection attempts to <code class="docutils literal"><span class="pre">address</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">tls</span></code></td>
<td>TLS config (see below)</td>
</tr>
</tbody>
</table>
<p>Establishes a TCP connection to <code class="docutils literal"><span class="pre">address</span></code> and sends log messages with minimum level <code class="docutils literal"><span class="pre">level</span></code> formatted by <code class="docutils literal"><span class="pre">format</span></code>.</p>
<p>If <code class="docutils literal"><span class="pre">tls</span></code> is not specified, an unencrypted connection is established.</p>
<p>If <code class="docutils literal"><span class="pre">tls</span></code> is specified, the TCP connection is secured with TLS + Client Authentication.
This is particularly useful in combination with log aggregation services that run on an other machine.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ca</span></code></td>
<td>PEM-encoded certificate authority that signed the remote server&#8217;s TLS certificate</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">cert</span></code></td>
<td>PEM-encoded client certificate identifying this zrepl daemon toward the remote server</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">key</span></code></td>
<td>PEM-encoded, unencrypted client private key identifying this zrepl daemon toward the remote server</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>zrepl drops log messages to the TCP outlet if the underlying connection is not fast enough.
Note that TCP buffering in the kernel must first run full becfore messages are dropped.</p>
<p class="last">Make sure to always configure a <code class="docutils literal"><span class="pre">stdout</span></code> outlet as the special error outlet to be informed about problems
with the TCP outlet (see <a class="reference internal" href="#logging-error-outlet"><span class="std std-ref">above</span></a> ).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">zrepl uses Go&#8217;s <code class="docutils literal"><span class="pre">crypto/tls</span></code> and <code class="docutils literal"><span class="pre">crypto/x509</span></code> packages and leaves all but the required fields in <code class="docutils literal"><span class="pre">tls.Config</span></code> at their default values.
In case of a security defect in these packages, zrepl has to be rebuilt because Go binaries are statically linked.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="misc.html" class="btn btn-neutral float-right" title="Miscellaneous" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="prune.html" class="btn btn-neutral" title="Pruning Policies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Christian Schwarz.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: push
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../0.0.2/configuration/logging.html">0.0.2</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../master/configuration/logging.html">master</a></dd>
            <dd><a href="../../parallel_zfs_ops/configuration/logging.html">parallel_zfs_ops</a></dd>
            <dd><a href="logging.html">push</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>