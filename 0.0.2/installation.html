

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation &mdash; zrepl  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="zrepl  documentation" href="index.html"/>
        <link rel="next" title="Configuration" href="configuration.html"/>
        <link rel="prev" title="Tutorial" href="tutorial.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> zrepl
          

          
            
            <img src="_static/zrepl.svg" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#user-privileges">User Privileges</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packages">Packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compile-from-source">Compile From Source</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-files">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#runtime-directories">Runtime Directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-daemon">Running the Daemon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#restarting">Restarting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="implementation.html">Implementation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/zrepl/zrepl">GitHub Repository &amp; Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="pr.html">Talks &amp; Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">zrepl</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../master/installation.html"><b>Warning:</b> This document is for an old version of zrepl. The main version is master.</a></p>
<div class="section" id="installation">
<span id="id1"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Note: check out the <a class="reference internal" href="tutorial.html#tutorial"><span class="std std-ref">Tutorial</span></a> if you want a first impression of zrepl.</p>
</div>
<div class="section" id="user-privileges">
<h2>User Privileges<a class="headerlink" href="#user-privileges" title="Permalink to this headline">¶</a></h2>
<p>It is possible to run zrepl as an unprivileged user in combination with
<a class="reference external" href="https://www.freebsd.org/doc/handbook/zfs-zfs-allow.html">ZFS delegation</a>.
Also, there is the possibility to run it in a jail on FreeBSD by delegating a dataset to the jail.
However, until we get around documenting those setups, you will have to run zrepl as root or experiment yourself :)</p>
</div>
<div class="section" id="packages">
<h2>Packages<a class="headerlink" href="#packages" title="Permalink to this headline">¶</a></h2>
<p>zrepl releases are signed &amp; tagged by the author in the git repository.
Your OS vendor may provide binary packages of zrepl through the package manager.
The following list may be incomplete, feel free to submit a PR with an update:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">OS / Distro</th>
<th class="head">Install Command</th>
<th class="head">Link</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>FreeBSD</td>
<td><code class="docutils literal"><span class="pre">pkg</span> <span class="pre">install</span> <span class="pre">zrepl</span></code></td>
<td><a class="reference external" href="https://www.freshports.org/sysutils/zrepl/">https://www.freshports.org/sysutils/zrepl/</a></td>
</tr>
<tr class="row-odd"><td>Others</td>
<td>&#160;</td>
<td>Install from source, see below</td>
</tr>
</tbody>
</table>
<div class="section" id="compile-from-source">
<h3>Compile From Source<a class="headerlink" href="#compile-from-source" title="Permalink to this headline">¶</a></h3>
<p>Go 1.9 or newer and a configured <code class="docutils literal"><span class="pre">$GOPATH</span></code> environment variable and a few build dependencies are required to build zrepl.
A tutorial is available over at <a class="reference external" href="https://golang.org/doc/install">golang.org</a>.
If Go 1.9 is not available on your distro consider build in Docker (see below).</p>
<p>The following shell script checks out the zrepl project into your <code class="docutils literal"><span class="pre">$GOPATH</span></code>,
installs the build dependencies, installs dependencies using <code class="docutils literal"><span class="pre">dep</span> <span class="pre">ensure</span></code> and does a <code class="docutils literal"><span class="pre">make</span> <span class="pre">release</span></code>.
Build artifacts are placed into <code class="docutils literal"><span class="pre">$GOPATH/github.com/zrepl/zrepl/artifacts/</span></code>.</p>
<p>When doing builds afterwards, it should be sufficient to checkout the new revision, run <code class="docutils literal"><span class="pre">dep</span> <span class="pre">ensure</span></code> and <code class="docutils literal"><span class="pre">make</span> <span class="pre">release</span></code>.
You may want to switch to a tagged commit (we use <a class="reference external" href="http://semver.org">semver</a>) but master should generally be considered stable.</p>
<p><strong>Note</strong>: it is your job to install the apropriate binary in the zrepl users&#8217;s <code class="docutils literal"><span class="pre">$PATH</span></code>, e.g. <code class="docutils literal"><span class="pre">/usr/local/bin/zrepl</span></code>.
Otherwise, the examples in the <a class="reference internal" href="tutorial.html#tutorial"><span class="std std-ref">Tutorial</span></a> may need to be adjusted.</p>
<p><strong>You are encouraged to understand what happens by auditing the script.</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="s1">&#39;https://raw.githubusercontent.com/zrepl/zrepl/master/clone_and_build.sh&#39;</span> <span class="o">|</span> <span class="n">sh</span>
</pre></div>
</div>
<p>You can also build in a Docker container if you want an isolated build environment or don&#8217;t have a compatible Go version.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">zrepl</span><span class="o">/</span><span class="n">zrepl</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">zrepl</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">rm</span> \
    <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;$</span><span class="si">{PWD}</span><span class="s2">:/zrepl&quot;</span> \
    <span class="o">--</span><span class="n">user</span> <span class="s2">&quot;$(id -u):$(id -g)&quot;</span> \
    <span class="n">golang</span><span class="p">:</span><span class="n">latest</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;export CLONEPATH=/go/src/github.com/zrepl; mkdir -p &quot;$CLONEPATH&quot; &amp;&amp; ln -s /zrepl $CLONEPATH/zrepl &amp;&amp; $</span><span class="si">{CLONEPATH}</span><span class="s1">/zrepl/clone_and_build.sh&#39;</span>
</pre></div>
</div>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="nb">set</span> -e

<span class="nv">bold</span><span class="o">=</span><span class="k">$(</span>tput bold<span class="k">)</span>
<span class="nv">normal</span><span class="o">=</span><span class="k">$(</span>tput sgr0<span class="k">)</span>

step<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">bold</span><span class="si">}</span><span class="nv">$1</span><span class="si">${</span><span class="nv">normal</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$GOPATH</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    step <span class="s2">&quot;Make sure you have your GOPATH configured correctly&quot;</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

step <span class="s2">&quot;Checkout sources to \$GOPATH/github.com/zrepl/zrepl&quot;</span>
<span class="nv">CHECKOUTPATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GOPATH</span><span class="si">}</span><span class="s2">/src/github.com/zrepl/zrepl&quot;</span>
<span class="k">if</span> <span class="o">[</span> -e <span class="s2">&quot;</span><span class="nv">$CHECKOUTPATH</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CHECKOUTPATH</span><span class="si">}</span><span class="s2"> already exists&quot;</span>
    <span class="k">if</span> <span class="o">[</span> ! -d <span class="s2">&quot;</span><span class="nv">$CHECKOUTPATH</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CHECKOUTPATH</span><span class="si">}</span><span class="s2"> is not a directory, aborting&quot;</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="k">else</span>
        <span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$CHECKOUTPATH</span><span class="s2">&quot;</span>
    <span class="k">fi</span>
<span class="k">else</span>
    mkdir -p <span class="s2">&quot;</span><span class="nv">$GOPATH</span><span class="s2">/src/github.com/zrepl&quot;</span>
    <span class="nb">cd</span> <span class="s2">&quot;</span><span class="nv">$GOPATH</span><span class="s2">/src/github.com/zrepl&quot;</span>
    git clone https://github.com/zrepl/zrepl.git
    <span class="nb">cd</span> zrepl
<span class="k">fi</span>

step <span class="s2">&quot;Install build depdencies using &#39;go get&#39; to \$GOPATH/bin&quot;</span>
go get -u golang.org/x/tools/cmd/stringer
go get -u github.com/golang/dep/cmd/dep
<span class="k">if</span> ! <span class="nb">type</span> stringer <span class="o">||</span> ! <span class="nb">type</span> dep<span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Installed dependencies but can&#39;t find them in \$PATH, adjust it to contain \$GOPATH/bin&quot;</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

step <span class="s2">&quot;Fetching dependencies using &#39;dep ensure&#39;&quot;</span>
dep ensure

step <span class="s2">&quot;Making release&quot;</span>
make release

step <span class="s2">&quot;Release artifacts are available in </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/artifacts&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuration-files">
<span id="mainconfigfile"></span><h2>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h2>
<p>zrepl searches for its main configuration file in the following locations (in that order):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">/etc/zrepl/zrepl.yml</span></code></li>
<li><code class="docutils literal"><span class="pre">/usr/local/etc/zrepl/zrepl.yml</span></code></li>
</ul>
<p>Alternatively, use CLI flags to specify a config location.
Copy a config from the <a class="reference internal" href="tutorial.html#tutorial"><span class="std std-ref">Tutorial</span></a> or the <code class="docutils literal"><span class="pre">cmd/sampleconf</span></code> directory to one of these locations and customize it to your setup.</p>
</div>
<div class="section" id="runtime-directories">
<h2>Runtime Directories<a class="headerlink" href="#runtime-directories" title="Permalink to this headline">¶</a></h2>
<p>zrepl requires ephemeral runtime directories where control sockets, etc are placed.
Refer to the <a class="reference internal" href="configuration/misc.html#conf-runtime-directories"><span class="std std-ref">configuration documentation</span></a> for more information.</p>
<p>When installing from a package, the package maintainer should have taken care of setting them up through the init system.
Alternatively, for default settings, the following should to the trick.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">zrepl</span><span class="o">/</span><span class="n">stdinserver</span>
<span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="mi">0700</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">zrepl</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-daemon">
<h2>Running the Daemon<a class="headerlink" href="#running-the-daemon" title="Permalink to this headline">¶</a></h2>
<p>All actual work zrepl does is performed by a daemon process.
Logging is configurable via the config file. Please refer to the <a class="reference internal" href="configuration/logging.html#logging"><span class="std std-ref">logging documention</span></a>.</p>
<p>When installating from a package, the package maintainer should have provided an init script / systemd.service file.
You should thus be able to start zrepl daemon using your init system.</p>
<p>Alternatively, or for running zrepl in the foreground, simply execute <code class="docutils literal"><span class="pre">zrepl</span> <span class="pre">daemon</span></code>.
Note that you won&#8217;t see any output unless you configure <a class="reference internal" href="configuration/logging.html#logging-outlet-stdout"><span class="std std-ref">stdout logging outlet</span></a>.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p>Make sure to actually monitor the error level output of zrepl: some configuration errors will not make the daemon exit.</p>
<p class="last">Example: if the daemon cannot create the <a class="reference internal" href="configuration/transports.html#transport-ssh-stdinserver"><span class="std std-ref">ssh+stdinserver Transport</span></a> sockets in the runtime directory,
it will emit an error message but not exit because other tasks such as periodic snapshots &amp; pruning are of equal importance.</p>
</div>
<div class="section" id="restarting">
<span id="install-restarting"></span><h3>Restarting<a class="headerlink" href="#restarting" title="Permalink to this headline">¶</a></h3>
<p>The daemon handles SIGINT and SIGTERM for graceful shutdown.
Graceful shutdown means at worst that a job will not be rescheduled for the next interval.
The daemon exits as soon as all jobs have reported shut down.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration.html" class="btn btn-neutral float-right" title="Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial.html" class="btn btn-neutral" title="Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Christian Schwarz.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 0.0.2
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="installation.html">0.0.2</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../master/installation.html">master</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>