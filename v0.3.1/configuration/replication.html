

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Replication Options &mdash; zrepl  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Taking Snaphots" href="snapshotting.html" />
    <link rel="prev" title="Send &amp; Recv Options" href="sendrecvoptions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> zrepl
          

          
            
            <img src="../_static/zrepl.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start by Use Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview &amp; Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="jobs.html">Job Types in Detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="transports.html">Transports</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter_syntax.html">Filter Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="sendrecvoptions.html">Send &amp; Recv Options</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Replication Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#protection-option"><code class="docutils literal notranslate"><span class="pre">protection</span></code> option</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="snapshotting.html">Taking Snaphots</a></li>
<li class="toctree-l2"><a class="reference internal" href="prune.html">Pruning Policies</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pr.html">Talks &amp; Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/zrepl/zrepl">GitHub Repository &amp; Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supporters.html">Supporters</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">zrepl</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../configuration.html">Configuration</a> &raquo;</li>
        
      <li>Replication Options</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/zrepl/zrepl/blob/v0.3.1/docs/configuration/replication.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../../stable/configuration/replication.html"><b>Warning:</b> This document is for an old version of zrepl. The main version is stable.</a></p>
<div class="section" id="replication-options">
<h1>Replication Options<a class="headerlink" href="#replication-options" title="Permalink to this headline">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jobs</span><span class="p">:</span>
<span class="o">-</span> <span class="nb">type</span><span class="p">:</span> <span class="n">push</span>
  <span class="n">filesystems</span><span class="p">:</span> <span class="o">...</span>
  <span class="n">replication</span><span class="p">:</span>
    <span class="n">protection</span><span class="p">:</span>
      <span class="n">initial</span><span class="p">:</span>     <span class="n">guarantee_resumability</span> <span class="c1"># guarantee_{resumability,incremental,nothing}</span>
      <span class="n">incremental</span><span class="p">:</span> <span class="n">guarantee_resumability</span> <span class="c1"># guarantee_{resumability,incremental,nothing}</span>
  <span class="o">...</span>
</pre></div>
</div>
<div class="section" id="protection-option">
<span id="replication-option-protection"></span><h2><code class="docutils literal notranslate"><span class="pre">protection</span></code> option<a class="headerlink" href="#protection-option" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">protection</span></code> variable controls the degree to which a replicated filesystem is protected from getting out of sync through a zrepl pruner or external tools that destroy snapshots.
zrepl can guarantee <a class="reference internal" href="overview.html#step-holds"><span class="std std-ref">resumability</span></a> or just <a class="reference internal" href="overview.html#replication-cursor-and-last-received-hold"><span class="std std-ref">incremental replication</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">guarantee_resumability</span></code> is the <strong>default</strong> value and guarantees that a replication step is always resumable and that incremental replication will always be possible.
The implementation uses replication cursors, last-received-hold and step holds.</p>
<p><code class="docutils literal notranslate"><span class="pre">guarantee_incremental</span></code> only guarantees that incremental replication will always be possible.
If a step <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">-&gt;</span> <span class="pre">to</span></code> is interrupted and its <cite>to</cite> snapshot is destroyed, zrepl will remove the half-received <code class="docutils literal notranslate"><span class="pre">to</span></code>’s resume state and start a new step <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">-&gt;</span> <span class="pre">to2</span></code>.
The implementation uses replication cursors, tentative replication cursors and last-received-hold.</p>
<p><code class="docutils literal notranslate"><span class="pre">guarantee_nothing</span></code> does not make any guarantees with regards to keeping sending and receiving side in sync.
No bookmarks or holds are created to protect sender and receiver from diverging.</p>
<p><strong>Tradeoffs</strong></p>
<p>Using <code class="docutils literal notranslate"><span class="pre">guarantee_incremental</span></code> instead of <code class="docutils literal notranslate"><span class="pre">guarantee_resumability</span></code> obviously removes the resumability guarantee.
This means that replication progress is no longer monotonic which might lead to a replication setup that never makes progress if mid-step interruptions are too frequent (e.g. frequent network outages).
However, the advantage and <a class="reference external" href="https://github.com/zrepl/zrepl/issues/288">reason for existence</a> of the <code class="docutils literal notranslate"><span class="pre">incremental</span></code> mode is that it allows the pruner to delete snapshots of interrupted replication steps
which is useful if replication happens so rarely (or fails so frequently) that the amount of disk space exclusively referenced by the step’s snapshots becomes intolerable.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When changing this flag, obsoleted zrepl-managed bookmarks and holds will be destroyed on the next replication step that is attempted for each filesystem.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="snapshotting.html" class="btn btn-neutral float-right" title="Taking Snaphots" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sendrecvoptions.html" class="btn btn-neutral float-left" title="Send &amp; Recv Options" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2019, Christian Schwarz

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: v0.3.1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../v0.4.0/configuration/replication.html">v0.4.0</a></dd>
            <dd><a href="replication.html">v0.3.1</a></dd>
            <dd><a href="../../v0.2.1/index.html">v0.2.1</a></dd>
            <dd><a href="../../v0.1.1/index.html">v0.1.1</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../master/configuration/replication.html">master</a></dd>
            <dd><a href="../../stable/configuration/replication.html">stable</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>